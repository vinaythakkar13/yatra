'use client';

import { useEffect, useRef } from 'react';

// Lottie animation JSON data from After Effects
const animationData: any = {
    "v": "5.7.3",
    "fr": 60,
    "ip": 0,
    "op": 180,
    "w": 1920,
    "h": 1920,
    "nm": "animation",
    "ddd": 0,
    "assets": [],
    "layers": [
        {
            "ddd": 0,
            "ind": 1,
            "ty": 4,
            "nm": "Tick",
            "parent": 4,
            "sr": 1,
            "ks": {
                "o": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.833], "y": [0.833] },
                            "o": { "x": [0.167], "y": [0.167] },
                            "t": 0,
                            "s": [0]
                        },
                        {
                            "i": { "x": [0.833], "y": [0.833] },
                            "o": { "x": [0.167], "y": [0.167] },
                            "t": 3.115,
                            "s": [100]
                        },
                        { "t": 20.796875, "s": [100] }
                    ],
                    "ix": 11
                },
                "r": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.667], "y": [1] },
                            "o": { "x": [0.333], "y": [0] },
                            "t": 12,
                            "s": [-165]
                        },
                        { "t": 39, "s": [0] }
                    ],
                    "ix": 10
                },
                "p": { "a": 0, "k": [346.916, 346.917, 0], "ix": 2 },
                "a": { "a": 0, "k": [278.033, 227.218, 0], "ix": 1 },
                "s": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.667, 0.667, 0.667], "y": [1, 1, 1] },
                            "o": { "x": [0.333, 0.333, 0.333], "y": [0, 0, 0] },
                            "t": 19.533,
                            "s": [20, 20, 100]
                        },
                        { "t": 38.48046875, "s": [100, 100, 100] }
                    ],
                    "ix": 6
                }
            },
            "ao": 0,
            "shapes": [
                {
                    "ty": "gr",
                    "it": [
                        {
                            "ind": 0,
                            "ty": "sh",
                            "ix": 1,
                            "ks": {
                                "a": 0,
                                "k": {
                                    "i": [[0, 0], [0, 0], [0, 0]],
                                    "o": [[0, 0], [0, 0], [0, 0]],
                                    "v": [[-153.033, 0.588], [-51.404, 102.218], [153.032, -102.218]],
                                    "c": false
                                },
                                "ix": 2
                            },
                            "nm": "Path 1",
                            "mn": "ADBE Vector Shape - Group",
                            "hd": false
                        },
                        {
                            "ty": "st",
                            "c": { "a": 0, "k": [1, 1, 1, 1], "ix": 3 },
                            "o": { "a": 0, "k": 100, "ix": 4 },
                            "w": { "a": 0, "k": 55, "ix": 5 },
                            "lc": 2,
                            "lj": 2,
                            "bm": 0,
                            "nm": "Stroke 1",
                            "mn": "ADBE Vector Graphic - Stroke",
                            "hd": false
                        },
                        {
                            "ty": "tr",
                            "p": { "a": 0, "k": [278.033, 227.218], "ix": 2 },
                            "a": { "a": 0, "k": [0, 0], "ix": 1 },
                            "s": { "a": 0, "k": [100, 100], "ix": 3 },
                            "r": { "a": 0, "k": 0, "ix": 6 },
                            "o": { "a": 0, "k": 100, "ix": 7 },
                            "sk": { "a": 0, "k": 0, "ix": 4 },
                            "sa": { "a": 0, "k": 0, "ix": 5 },
                            "nm": "Transform"
                        }
                    ],
                    "nm": "Group 1",
                    "np": 2,
                    "cix": 2,
                    "bm": 0,
                    "ix": 1,
                    "mn": "ADBE Vector Group",
                    "hd": false
                },
                {
                    "ty": "tm",
                    "s": { "a": 0, "k": 0, "ix": 1 },
                    "e": {
                        "a": 1,
                        "k": [
                            {
                                "i": { "x": [0.33], "y": [1] },
                                "o": { "x": [0.67], "y": [0] },
                                "t": 20.164,
                                "s": [0]
                            },
                            { "t": 38.48046875, "s": [100] }
                        ],
                        "ix": 2
                    },
                    "o": { "a": 0, "k": 0, "ix": 3 },
                    "m": 1,
                    "ix": 2,
                    "nm": "Trim Paths 1",
                    "mn": "ADBE Vector Filter - Trim",
                    "hd": false
                }
            ],
            "ip": 0,
            "op": 1800,
            "st": 0,
            "bm": 0
        },
        {
            "ddd": 0,
            "ind": 2,
            "ty": 4,
            "nm": "Glow Mask",
            "td": 1,
            "sr": 1,
            "ks": {
                "o": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.833], "y": [0.833] },
                            "o": { "x": [0.167], "y": [0.167] },
                            "t": 0,
                            "s": [0]
                        },
                        {
                            "i": { "x": [0.833], "y": [0.833] },
                            "o": { "x": [0.167], "y": [0.167] },
                            "t": 3.115,
                            "s": [100]
                        },
                        { "t": 20.796875, "s": [100] }
                    ],
                    "ix": 11
                },
                "r": { "a": 0, "k": 0, "ix": 10 },
                "p": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": 0.783, "y": 0.48 },
                            "o": { "x": 0.506, "y": 0 },
                            "t": 0,
                            "s": [1099.01, 1187.835, 0],
                            "to": [-51.058, -20.951, 0],
                            "ti": [23.519, 29.424, 0]
                        },
                        {
                            "i": { "x": 0.576, "y": 1 },
                            "o": { "x": 0.337, "y": 0.496 },
                            "t": 19.533,
                            "s": [989.155, 1114.015, 0],
                            "to": [-26.997, -33.775, 0],
                            "ti": [3.563, 56.649, 0]
                        },
                        { "t": 32.1640625, "s": [947.01, 981.835, 0] }
                    ],
                    "ix": 2
                },
                "a": { "a": 0, "k": [346.917, 346.917, 0], "ix": 1 },
                "s": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.667, 0.667, 0.667], "y": [1, 1, 1] },
                            "o": { "x": [0.333, 0.333, 0.333], "y": [0, 0, 0] },
                            "t": 19.533,
                            "s": [20, 20, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.333, 0.333, 0.333], "y": [0, 0, 0] },
                            "t": 38.48,
                            "s": [110, 110, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.167, 0.167, 0.167], "y": [0, 0, 0] },
                            "t": 51.109,
                            "s": [95, 95, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.167, 0.167, 0.167], "y": [0, 0, 0] },
                            "t": 58.688,
                            "s": [102, 102, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.167, 0.167, 0.167], "y": [0, 0, 0] },
                            "t": 63.74,
                            "s": [98, 98, 100]
                        },
                        { "t": 70.0546875, "s": [100, 100, 100] }
                    ],
                    "ix": 6
                }
            },
            "ao": 0,
            "shapes": [
                {
                    "ty": "gr",
                    "it": [
                        {
                            "ind": 0,
                            "ty": "sh",
                            "ix": 1,
                            "ks": {
                                "a": 0,
                                "k": {
                                    "i": [[0, -191.459], [191.459, 0], [0, 191.458], [-191.458, 0]],
                                    "o": [[0, 191.458], [-191.458, 0], [0, -191.459], [191.459, 0]],
                                    "v": [[346.667, 0], [0, 346.667], [-346.667, 0], [0, -346.666]],
                                    "c": true
                                },
                                "ix": 2
                            },
                            "nm": "Path 1",
                            "mn": "ADBE Vector Shape - Group",
                            "hd": false
                        },
                        {
                            "ty": "fl",
                            "c": { "a": 0, "k": [0.118000000598, 0.442999985639, 0.929000016755, 1], "ix": 4 },
                            "o": { "a": 0, "k": 100, "ix": 5 },
                            "r": 1,
                            "bm": 0,
                            "nm": "Fill 1",
                            "mn": "ADBE Vector Graphic - Fill",
                            "hd": false
                        },
                        {
                            "ty": "tr",
                            "p": { "a": 0, "k": [346.916, 346.917], "ix": 2 },
                            "a": { "a": 0, "k": [0, 0], "ix": 1 },
                            "s": { "a": 0, "k": [100, 100], "ix": 3 },
                            "r": { "a": 0, "k": 0, "ix": 6 },
                            "o": { "a": 0, "k": 100, "ix": 7 },
                            "sk": { "a": 0, "k": 0, "ix": 4 },
                            "sa": { "a": 0, "k": 0, "ix": 5 },
                            "nm": "Transform"
                        }
                    ],
                    "nm": "Group 1",
                    "np": 2,
                    "cix": 2,
                    "bm": 0,
                    "ix": 1,
                    "mn": "ADBE Vector Group",
                    "hd": false
                }
            ],
            "ip": 0,
            "op": 1800,
            "st": 0,
            "bm": 0
        },
        {
            "ddd": 0,
            "ind": 3,
            "ty": 4,
            "nm": "Glow",
            "tt": 1,
            "sr": 1,
            "ks": {
                "o": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.833], "y": [1] },
                            "o": { "x": [0.167], "y": [0] },
                            "t": 0,
                            "s": [0]
                        },
                        {
                            "i": { "x": [0.833], "y": [1] },
                            "o": { "x": [0.167], "y": [0] },
                            "t": 3.115,
                            "s": [100]
                        },
                        {
                            "i": { "x": [0.833], "y": [0.643] },
                            "o": { "x": [0.72], "y": [0] },
                            "t": 70.055,
                            "s": [100]
                        },
                        { "t": 89, "s": [0] }
                    ],
                    "ix": 11
                },
                "r": { "a": 0, "k": 0, "ix": 10 },
                "p": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": 0.833, "y": 0.788 },
                            "o": { "x": 0.72, "y": 0 },
                            "t": 59.951,
                            "s": [56, 440, 0],
                            "to": [226.667, 131.333, 0],
                            "ti": [-226.667, -131.333, 0]
                        },
                        { "t": 89, "s": [1416, 1228, 0] }
                    ],
                    "ix": 2
                },
                "a": { "a": 0, "k": [0, 0, 0], "ix": 1 },
                "s": { "a": 0, "k": [100, 100, 100], "ix": 6 }
            },
            "ao": 0,
            "shapes": [
                {
                    "ty": "gr",
                    "it": [
                        {
                            "ind": 0,
                            "ty": "sh",
                            "ix": 1,
                            "ks": {
                                "a": 0,
                                "k": {
                                    "i": [[0, 0], [348.655, 1.947], [0, 0], [35.647, 880.072]],
                                    "o": [[0, 0], [-8.868, -0.049], [0, 0], [-3.819, -94.283]],
                                    "v": [[211.999, -440], [-480, 280], [-136, 648], [483.999, -312]],
                                    "c": true
                                },
                                "ix": 2
                            },
                            "nm": "Path 1",
                            "mn": "ADBE Vector Shape - Group",
                            "hd": false
                        },
                        {
                            "ty": "fl",
                            "c": { "a": 0, "k": [0.76862745098, 0.823067997951, 1, 1], "ix": 4 },
                            "o": { "a": 0, "k": 30, "ix": 5 },
                            "r": 1,
                            "bm": 0,
                            "nm": "Fill 1",
                            "mn": "ADBE Vector Graphic - Fill",
                            "hd": false
                        },
                        {
                            "ty": "tr",
                            "p": { "a": 0, "k": [0, 0], "ix": 2 },
                            "a": { "a": 0, "k": [0, 0], "ix": 1 },
                            "s": { "a": 0, "k": [100, 100], "ix": 3 },
                            "r": { "a": 0, "k": 0, "ix": 6 },
                            "o": { "a": 0, "k": 100, "ix": 7 },
                            "sk": { "a": 0, "k": 0, "ix": 4 },
                            "sa": { "a": 0, "k": 0, "ix": 5 },
                            "nm": "Transform"
                        }
                    ],
                    "nm": "Shape 1",
                    "np": 3,
                    "cix": 2,
                    "bm": 0,
                    "ix": 1,
                    "mn": "ADBE Vector Group",
                    "hd": false
                }
            ],
            "ip": 0,
            "op": 1800,
            "st": 0,
            "bm": 0
        },
        {
            "ddd": 0,
            "ind": 4,
            "ty": 4,
            "nm": "Background Circle (Blue)",
            "sr": 1,
            "ks": {
                "o": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.833], "y": [0.833] },
                            "o": { "x": [0.167], "y": [0.167] },
                            "t": 0,
                            "s": [0]
                        },
                        {
                            "i": { "x": [0.833], "y": [0.833] },
                            "o": { "x": [0.167], "y": [0.167] },
                            "t": 8,
                            "s": [100]
                        },
                        { "t": 20.796875, "s": [100] }
                    ],
                    "ix": 11
                },
                "r": { "a": 0, "k": 0, "ix": 10 },
                "p": { "a": 0, "k": [960, 960, 0], "ix": 2 },
                "a": { "a": 0, "k": [346.917, 346.917, 0], "ix": 1 },
                "s": {
                    "a": 1,
                    "k": [
                        {
                            "i": { "x": [0.667, 0.667, 0.667], "y": [1, 1, 1] },
                            "o": { "x": [0.333, 0.333, 0.333], "y": [0, 0, 0] },
                            "t": 19.533,
                            "s": [20, 20, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.333, 0.333, 0.333], "y": [0, 0, 0] },
                            "t": 39,
                            "s": [110, 110, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.167, 0.167, 0.167], "y": [0, 0, 0] },
                            "t": 51.109,
                            "s": [95, 95, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.167, 0.167, 0.167], "y": [0, 0, 0] },
                            "t": 58.688,
                            "s": [102, 102, 100]
                        },
                        {
                            "i": { "x": [0.833, 0.833, 0.833], "y": [1, 1, 1] },
                            "o": { "x": [0.167, 0.167, 0.167], "y": [0, 0, 0] },
                            "t": 63.74,
                            "s": [98, 98, 100]
                        },
                        { "t": 70.0546875, "s": [100, 100, 100] }
                    ],
                    "ix": 6
                }
            },
            "ao": 0,
            "shapes": [
                {
                    "ty": "gr",
                    "it": [
                        {
                            "ind": 0,
                            "ty": "sh",
                            "ix": 1,
                            "ks": {
                                "a": 0,
                                "k": {
                                    "i": [[0, -191.459], [191.459, 0], [0, 191.458], [-191.458, 0]],
                                    "o": [[0, 191.458], [-191.458, 0], [0, -191.459], [191.459, 0]],
                                    "v": [[346.667, 0], [0, 346.667], [-346.667, 0], [0, -346.666]],
                                    "c": true
                                },
                                "ix": 2
                            },
                            "nm": "Path 1",
                            "mn": "ADBE Vector Shape - Group",
                            "hd": false
                        },
                        {
                            "ty": "fl",
                            "c": { "a": 0, "k": [0.313725490196, 0.81568627451, 0.360784313725, 1], "ix": 4 },
                            "o": { "a": 0, "k": 100, "ix": 5 },
                            "r": 1,
                            "bm": 0,
                            "nm": "Fill 1",
                            "mn": "ADBE Vector Graphic - Fill",
                            "hd": false
                        },
                        {
                            "ty": "tr",
                            "p": { "a": 0, "k": [346.916, 346.917], "ix": 2 },
                            "a": { "a": 0, "k": [0, 0], "ix": 1 },
                            "s": { "a": 0, "k": [100, 100], "ix": 3 },
                            "r": { "a": 0, "k": 0, "ix": 6 },
                            "o": { "a": 0, "k": 100, "ix": 7 },
                            "sk": { "a": 0, "k": 0, "ix": 4 },
                            "sa": { "a": 0, "k": 0, "ix": 5 },
                            "nm": "Transform"
                        }
                    ],
                    "nm": "Group 1",
                    "np": 2,
                    "cix": 2,
                    "bm": 0,
                    "ix": 1,
                    "mn": "ADBE Vector Group",
                    "hd": false
                }
            ],
            "ip": 0,
            "op": 1800,
            "st": 0,
            "bm": 0
        }
    ],
    "markers": []
};

interface AnimatedSuccessIconProps {
    className?: string;
    size?: number;
    loop?: boolean;
}

export default function AnimatedSuccessIcon({
    className = '',
    size = 200,
    loop = true
}: AnimatedSuccessIconProps) {
    const containerRef = useRef<HTMLDivElement>(null);
    const animationRef = useRef<any>(null);

    useEffect(() => {
        if (!containerRef.current) return;

        // Use dotlottie-web which is already installed
        import('@lottiefiles/dotlottie-web').then((dotLottieModule) => {
            if (containerRef.current && !animationRef.current) {
                const { DotLottie } = dotLottieModule;

                // Create a canvas element
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                containerRef.current.appendChild(canvas);

                // DotLottie accepts data as object (Lottie JSON)
                animationRef.current = new DotLottie({
                    canvas: canvas,
                    data: animationData,
                    loop: loop,
                    autoplay: true,
                });
            }
        }).catch((error) => {
            console.error('Failed to load dotlottie-web:', error);
        });

        return () => {
            if (animationRef.current) {
                animationRef.current.destroy();
                animationRef.current = null;
            }
            if (containerRef.current) {
                containerRef.current.innerHTML = '';
            }
        };
    }, [loop, size]);

    return (
        <div
            ref={containerRef}
            className={className}
            style={{
                width: size,
                height: size,
                margin: '0 auto'
            }}
        />
    );
}
